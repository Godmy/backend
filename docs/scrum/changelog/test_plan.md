# Тестовый план: развитие автоматизированного покрытия backend

## 1. Ближайшие действия (1–2 спринта)
- Поднять отдельный docker-compose профиль для тестов (`postgres`, `redis`, `mailpit`) + фикстуры `pytest` для подключения.
- Завести smoke-набор GraphQL: `GetDashboardStats`, `GetAdminStats`, CRUD по ключевым сущностям (языки, концепты, словари).
- Нормализовать seed-фабрики (factory-boy/pytest-factoryboy) вместо прямого SQL, чтобы сценарии быстрее собирались.
- Подключить `pytest --maxfail=1 --disable-warnings` в CI (GitHub Actions) и сделать обязательным для PR.

## 2. Среднесрочные задачи (3–5 спринтов)
- Покрыть интеграционными тестами аутентификацию, разрешения и аудит (включая тестовые токены, rate-limit, кэш).
- Добавить контур «наблюдаемых» тестов: Celery-тasks, email-уведомления, импорт/экспорт (проверки на idempotency).
- Внедрить снепшоты GraphQL (например, `pytest-syrupy`) для стабильных ответов и быстрых регрессий.
- Вести метрики покрытия (coverage + метрика успешного/проваленного прогона) с публикацией в Codecov/Allure.

## 3. Долгосрочные цели
- Подготовить контрактные тесты для Houdini/фронтенда (schemathesis или generated client), чтобы ловить несовместимые изменения.
- Добавить хаос-тесты/negative-journeys: выключение Redis, деградация БД, повторные срабатывания webhook.
- Встроить smoke-проверку `scripts/check-dashboard-stats.mjs` в деплой: после выката стейджинга дергать GraphQL и смотреть на реальные цифры.
- Регулярные тест-ревью: перечень обязательных сценариев + обновление документации по новым фичам.*** End Patch
