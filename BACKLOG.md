# Product Backlog - –ú—É–ª—å—Ç–∏–ü–£–õ–¨–¢

–ë—ç–∫–ª–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏—Å—Ç–æ—Ä–∏–π –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ production-ready backend template.

## –õ–µ–≥–µ–Ω–¥–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

- üî• **P0** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ (–±–ª–æ–∫–∏—Ä—É–µ—Ç production)
- ‚ö° **P1** - –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≤–∞–∂–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- üìå **P2** - –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—É–ª—É—á—à–µ–Ω–∏–µ UX)
- üí° **P3** - –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (nice to have)

## –°—Ç–∞—Ç—É—Å—ã

- üìã **Backlog** - –≤ –æ—á–µ—Ä–µ–¥–∏
- üöß **In Progress** - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- ‚úÖ **Done** - –∑–∞–≤–µ—Ä—à–µ–Ω–æ
- üîí **Blocked** - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ

## üéØ Vision: Production-Ready Template –¥–ª—è —Ç—ã—Å—è—á –ø—Ä–æ–µ–∫—Ç–æ–≤

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π backend-—à–∞–±–ª–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–∞–∫ submodule –≤ –ª—é–±–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∏ –∑–∞–ø—É—â–µ–Ω –≤ production –∑–∞ 30 –º–∏–Ω—É—Ç.

---

## Top 10 –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –ó–∞–¥–∞—á

### 1. üî• P0 - File Upload System –¥–ª—è Avatars –∏ Attachments

**User Story:**
> –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —è —Ö–æ—á—É –∑–∞–≥—Ä—É–∂–∞—Ç—å –∞–≤–∞—Ç–∞—Ä –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è –∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Ñ–∞–π–ª—ã –∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º, —á—Ç–æ–±—ã –≤–∏–∑—É–∞–ª—å–Ω–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –º–µ–¥–∏–∞ –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É.

**Acceptance Criteria:**
- [‚úÖ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ GraphQL (multipart/form-data)
- [‚úÖ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–ª–∏ S3
- [‚úÖ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (JPEG, PNG, GIF –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤)
- [‚úÖ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ (5MB –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤, 10MB –¥–ª—è attachments)
- [‚úÖ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è thumbnails –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [‚úÖ] Secure filename sanitization
- [‚úÖ] GraphQL mutations: `uploadAvatar`, `uploadFile`, `deleteFile`
- [‚úÖ] Endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤: `/uploads/:filename`

**Implementation:**
- `core/models/file.py` - –º–æ–¥–µ–ª—å File –¥–ª—è –ë–î
- `core/file_storage.py` - FileStorageService –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- `core/services/file_service.py` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- `core/schemas/file.py` - GraphQL API
- `app.py` - endpoint `/uploads/{filename:path}`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å UserProfileModel —Å `avatar_file_id`
- –î–æ–±–∞–≤–ª–µ–Ω Pillow –≤ requirements.txt

**Estimated Effort:** 5 story points

**Status:** ‚úÖ **Done** (2025-01-16)

---

### 2. ‚ö° P1 - Advanced Search & Filtering

**User Story:**
> –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —è —Ö–æ—á—É –∏—Å–∫–∞—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º, —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —è–∑—ã–∫–∞–º –∏ —Ç–µ–≥–∞–º, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

**Acceptance Criteria:**
- [ ] Full-text search –ø–æ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º (name, description)
- [ ] –ü–æ–∏—Å–∫ –ø–æ –ø–µ—Ä–µ–≤–æ–¥–∞–º –≤ —Å–ª–æ–≤–∞—Ä—è—Ö
- [ ] –§–∏–ª—å—Ç—Ä—ã: —è–∑—ã–∫, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ 20 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏, –∞–ª—Ñ–∞–≤–∏—Ç—É, –¥–∞—Ç–µ
- [ ] GraphQL query: `searchConcepts(query: String!, filters: SearchFilters)`
- [ ] PostgreSQL full-text search –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Elasticsearch

**Example Query:**
```graphql
query SearchConcepts {
  searchConcepts(
    query: "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
    filters: {
      languages: ["ru", "en"]
      dateFrom: "2024-01-01"
    }
    pagination: { limit: 20, offset: 0 }
    sortBy: RELEVANCE
  ) {
    results {
      id
      name
      translations {
        language { code }
        name
      }
    }
    totalCount
  }
}
```

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 3. ‚ö° P1 - User Profile Management

**User Story:**
> –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —è —Ö–æ—á—É —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º –ø—Ä–æ—Ñ–∏–ª–µ–º (–∏–º—è, –±–∏–æ, –∞–≤–∞—Ç–∞—Ä, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏), —á—Ç–æ–±—ã –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç.

**Acceptance Criteria:**
- [ ] GraphQL mutation: `updateProfile(input: ProfileUpdateInput!)`
- [ ] –ü–æ–ª—è: firstName, lastName, bio, avatar, timezone, language
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è: bio –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤
- [ ] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å email (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
- [ ] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å (—Å —Ç–µ–∫—É—â–∏–º –ø–∞—Ä–æ–ª–µ–º)
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ OAuth –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- [ ] –û—Ç–≤—è–∑–∫–∞ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (soft delete)

**Mutations:**
```graphql
mutation UpdateProfile {
  updateProfile(input: {
    firstName: "–ò–≤–∞–Ω"
    lastName: "–ü–µ—Ç—Ä–æ–≤"
    bio: "Backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫"
    timezone: "Europe/Moscow"
  }) {
    id
    firstName
    lastName
  }
}

mutation ChangeEmail {
  changeEmail(input: {
    newEmail: "newemail@example.com"
    password: "CurrentPass123!"
  }) {
    success
    message
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email –Ω–∞ –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  }
}

mutation DeleteAccount {
  deleteAccount(input: {
    password: "CurrentPass123!"
    reason: "–ù–µ –∏—Å–ø–æ–ª—å–∑—É—é –±–æ–ª—å—à–µ"
  }) {
    success
  }
}
```

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 4. üî• P0 - Audit Logging System

**User Story:**
> –ö–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤—Ö–æ–¥, –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —É–¥–∞–ª–µ–Ω–∏—è), —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞—É–¥–∏—Ç–∞.

**Acceptance Criteria:**
- [‚úÖ] –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å `AuditLog` —Å –ø–æ–ª—è–º–∏: user_id, action, entity_type, entity_id, old_data, new_data, ip_address, user_agent, timestamp, description, status
- [‚úÖ] –ì–æ—Ç–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: login, logout, register, OAuth login, entity CRUD
- [‚úÖ] GraphQL queries –¥–ª—è –∞–¥–º–∏–Ω–æ–≤: `auditLogs`, `myAuditLogs`, `userActivity`
- [‚úÖ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ user_id, action, entity_type, status, –¥–∞—Ç–∞–º
- [‚úÖ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- [‚úÖ] –ú–µ—Ç–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (`cleanup_old_logs`)
- [‚úÖ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Implementation:**
- `core/models/audit_log.py` - –º–æ–¥–µ–ª—å AuditLog
- `core/services/audit_service.py` - AuditService —Å –º–µ—Ç–æ–¥–∞–º–∏:
  - `log()` - –±–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - `log_login()`, `log_register()`, `log_logout()`
  - `log_entity_create/update/delete()`
  - `get_logs()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
  - `get_user_activity()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  - `cleanup_old_logs()` - –æ—á–∏—Å—Ç–∫–∞
- `core/schemas/audit.py` - GraphQL API –¥–ª—è –∞—É–¥–∏—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ core/schemas/schema.py

**Estimated Effort:** 8 story points

**Status:** ‚úÖ **Done** (2025-01-16)

---

### 5. ‚ö° P1 - API Rate Limiting

**User Story:**
> –ö–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, —è —Ö–æ—á—É –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/IP, —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π –∏ DDoS –∞—Ç–∞–∫.

**Acceptance Criteria:**
- [ ] Rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–µ —Ç–æ–ª—å–∫–æ nginx)
- [ ] –õ–∏–º–∏—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ: IP –∞–¥—Ä–µ—Å–∞, user_id, JWT —Ç–æ–∫–µ–Ω–∞
- [ ] –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoint'–æ–≤:
  - –û–±—ã—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: 100 req/min
  - –ú—É—Ç–∞—Ü–∏–∏: 20 req/min
  - Login/register: 5 req/min
  - Email –æ—Ç–ø—Ä–∞–≤–∫–∞: 3 req/hour (—É–∂–µ –µ—Å—Ç—å)
- [ ] Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤
- [ ] HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏: `X-RateLimit-Limit`, `X-RateLimit-Remaining`, `X-RateLimit-Reset`
- [ ] GraphQL error –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏: `RATE_LIMIT_EXCEEDED`
- [ ] –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ IP –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

**Implementation:**
```python
# core/rate_limiter.py
from functools import wraps
from starlette.requests import Request

def rate_limit(max_requests: int, window_seconds: int):
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            request = kwargs.get('info').context['request']
            ip = request.client.host
            key = f"rate_limit:{ip}:{func.__name__}"

            # Check Redis counter
            current = await redis.incr(key)
            if current == 1:
                await redis.expire(key, window_seconds)

            if current > max_requests:
                raise GraphQLError("Rate limit exceeded")

            return await func(*args, **kwargs)
        return wrapper
    return decorator
```

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 6. üìå P2 - Soft Delete –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π

**User Story:**
> –ö–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, —è —Ö–æ—á—É –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, —Å–ª–æ–≤–∞—Ä–∏), –≤–º–µ—Å—Ç–æ –∏—Ö –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è.

**Acceptance Criteria:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è `deleted_at`, `deleted_by` –≤ BaseModel
- [ ] –í—Å–µ DELETE –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–º–µ—á–∞—é—Ç `deleted_at = now()`
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–∫–ª—é—á–∞–µ—Ç deleted –∑–∞–ø–∏—Å–∏
- [ ] GraphQL query `archivedItems` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö
- [ ] –ú—É—Ç–∞—Ü–∏—è `restoreItem(id: ID!)` –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –ú—É—Ç–∞—Ü–∏—è `permanentlyDelete(id: ID!)` –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ permanent —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 90 –¥–Ω–µ–π

**BaseModel update:**
```python
# core/models/base.py
class BaseModel(Base):
    __abstract__ = True

    id = Column(Integer, primary_key=True, index=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    deleted_at = Column(DateTime, nullable=True)
    deleted_by = Column(Integer, ForeignKey("users.id"), nullable=True)

    @classmethod
    def active(cls):
        """–§–∏–ª—å—Ç—Ä –¥–ª—è –Ω–µ—É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π"""
        return cls.deleted_at.is_(None)
```

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 7. ‚ö° P1 - Import/Export System

**User Story:**
> –ö–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —è —Ö–æ—á—É —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥—ã –≤ JSON/CSV, —á—Ç–æ–±—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏ –∏–ª–∏ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã.

**Acceptance Criteria:**
- [ ] GraphQL mutation: `exportData(entityType: String!, format: ExportFormat!)`
- [ ] –§–æ—Ä–º–∞—Ç—ã: JSON, CSV, XLSX
- [ ] –≠–∫—Å–ø–æ—Ä—Ç: concepts, dictionaries, users (–±–µ–∑ –ø–∞—Ä–æ–ª–µ–π)
- [ ] –ò–º–ø–æ—Ä—Ç —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π: `importData(file: Upload!, entityType: String!)`
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: skip, update, or fail
- [ ] –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞ —á–µ—Ä–µ–∑ WebSocket –∏–ª–∏ polling
- [ ] –õ–æ–≥ –∏–º–ø–æ—Ä—Ç–∞: —É—Å–ø–µ—à–Ω—ã–µ/–æ—à–∏–±–æ—á–Ω—ã–µ –∑–∞–ø–∏—Å–∏

**Example:**
```graphql
mutation ExportConcepts {
  exportData(
    entityType: "concepts"
    format: JSON
    filters: { language: "ru" }
  ) {
    url  # –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
    expiresAt
  }
}

mutation ImportConcepts {
  importData(
    file: Upload!
    entityType: "concepts"
    options: {
      onDuplicate: UPDATE
      validateOnly: false
    }
  ) {
    jobId
    status
  }
}

query ImportStatus {
  importJob(id: "job-123") {
    status  # pending, processing, completed, failed
    progress  # 75%
    processedCount
    errorCount
    errors {
      row
      message
    }
  }
}
```

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

### 8. üìå P2 - Admin Panel Features

**User Story:**
> –ö–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, —è —Ö–æ—á—É —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏ —á–µ—Ä–µ–∑ GraphQL, —á—Ç–æ–±—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ.

**Acceptance Criteria:**
- [ ] GraphQL queries –¥–ª—è –∞–¥–º–∏–Ω–æ–≤:
  - `users(filters, pagination)` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - `userActivity(userId)` - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `systemStats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
- [ ] –ú—É—Ç–∞—Ü–∏–∏:
  - `adminUpdateUser` - –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `adminBanUser` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `adminUnbanUser` - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
  - `adminAssignRole` - –Ω–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å
  - `adminRevokeRole` - –æ—Ç–æ–∑–≤–∞—Ç—å —Ä–æ–ª—å
- [ ] –§–∏–ª—å—Ç—Ä—ã: –ø–æ —Ä–æ–ª—è–º, —Å—Ç–∞—Ç—É—Å—É (active/banned/unverified), –¥–∞—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- [ ] Bulk –æ–ø–µ—Ä–∞—Ü–∏–∏: –º–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π

**Queries:**
```graphql
query AdminGetUsers {
  users(
    filters: {
      role: "user"
      status: ACTIVE
      registeredAfter: "2024-01-01"
    }
    pagination: { limit: 50, offset: 0 }
    sortBy: { field: CREATED_AT, order: DESC }
  ) {
    users {
      id
      username
      email
      roles { name }
      isVerified
      isBanned
      lastLoginAt
    }
    totalCount
  }
}

query SystemStats {
  systemStats {
    totalUsers
    activeUsers
    totalConcepts
    totalTranslations
    languagesCount
    storageUsed
  }
}

mutation AdminBanUser {
  adminBanUser(
    userId: 123
    reason: "Spam"
    until: "2024-12-31"
  ) {
    success
    message
  }
}
```

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 9. üí° P3 - GraphQL Subscriptions (Real-time Updates)

**User Story:**
> –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —è —Ö–æ—á—É –ø–æ–ª—É—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã, –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–π), —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.

**Acceptance Criteria:**
- [ ] WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ Strawberry GraphQL
- [ ] Subscriptions:
  - `conceptUpdated(conceptId)` - –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
  - `translationAdded(conceptId)` - –Ω–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥
  - `userStatusChanged(userId)` - —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è online/offline
- [ ] Redis Pub/Sub –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –º–µ–∂–¥—É workers
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ WebSocket (JWT –≤ connection params)
- [ ] Graceful disconnect handling

**Implementation:**
```python
# –í core/schemas/schema.py
@strawberry.type
class Subscription:
    @strawberry.subscription
    async def concept_updated(
        self,
        info: Info,
        concept_id: int
    ) -> ConceptType:
        async for message in redis_subscribe(f"concept:{concept_id}"):
            yield message

# –ö–ª–∏–µ–Ω—Ç
subscription {
  conceptUpdated(conceptId: 123) {
    id
    name
    updatedAt
    dictionaries {
      language { code }
      name
    }
  }
}
```

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

### 10. üìå P2 - Notification System

**User Story:**
> –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —è —Ö–æ—á—É –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö (–Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ —è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é), —á—Ç–æ–±—ã –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ.

**Acceptance Criteria:**
- [ ] –ú–æ–¥–µ–ª—å `Notification`: type, title, message, is_read, user_id, entity_type, entity_id
- [ ] –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
  - `concept_updated` - –∏–∑–º–µ–Ω–µ–Ω–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è
  - `translation_added` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–≤–æ–¥
  - `comment_reply` - –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  - `role_assigned` - –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –Ω–æ–≤–∞—è —Ä–æ–ª—å
  - `system_announcement` - —Å–∏—Å—Ç–µ–º–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
- [ ] –î–æ—Å—Ç–∞–≤–∫–∞: in-app, email, web push (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] GraphQL queries:
  - `notifications(filters, pagination)` - —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - `unreadNotificationsCount` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- [ ] –ú—É—Ç–∞—Ü–∏–∏:
  - `markNotificationAsRead(id)`
  - `markAllAsRead`
  - `deleteNotification(id)`
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –∫–∞–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—É—á–∞—Ç—å

**Models:**
```python
# core/models/notification.py
class Notification(BaseModel):
    __tablename__ = "notifications"

    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    type = Column(String(50), nullable=False)
    title = Column(String(255), nullable=False)
    message = Column(Text)
    is_read = Column(Boolean, default=False)
    read_at = Column(DateTime, nullable=True)
    entity_type = Column(String(50))  # "concept", "comment"
    entity_id = Column(Integer)
    data = Column(JSON)  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

    user = relationship("User", backref="notifications")

class NotificationSettings(BaseModel):
    __tablename__ = "notification_settings"

    user_id = Column(Integer, ForeignKey("users.id"), unique=True)
    email_notifications = Column(Boolean, default=True)
    concept_updates = Column(Boolean, default=True)
    translation_updates = Column(Boolean, default=True)
    comments = Column(Boolean, default=True)
    system_announcements = Column(Boolean, default=True)
```

**Queries:**
```graphql
query GetNotifications {
  notifications(
    filters: { isRead: false }
    pagination: { limit: 20, offset: 0 }
  ) {
    notifications {
      id
      type
      title
      message
      isRead
      createdAt
      entity {
        ... on ConceptType {
          id
          name
        }
      }
    }
    totalCount
    unreadCount
  }
}

mutation MarkAsRead {
  markNotificationAsRead(id: 123) {
    success
  }
}
```

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ (P3 - Nice to Have)

### 11. üí° P3 - Two-Factor Authentication (2FA)

**User Story:**
> –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —è —Ö–æ—á—É –≤–∫–ª—é—á–∏—Ç—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç–∞.

**Acceptance Criteria:**
- [ ] TOTP (Time-based One-Time Password) —á–µ—Ä–µ–∑ Google Authenticator/Authy
- [ ] QR –∫–æ–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- [ ] Backup –∫–æ–¥—ã (10 –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –∫–æ–¥–æ–≤)
- [ ] –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è 2FA –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- [ ] Recovery –æ–ø—Ü–∏–∏ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**Estimated Effort:** 8 story points

---

### 12. üí° P3 - Comment System –¥–ª—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–π

**User Story:**
> –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —è —Ö–æ—á—É –æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º –∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º, —á—Ç–æ–±—ã –æ–±—Å—É–∂–¥–∞—Ç—å –∏—Ö —Å –¥—Ä—É–≥–∏–º–∏.

**Acceptance Criteria:**
- [ ] –ú–æ–¥–µ–ª—å `Comment` —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ (threads)
- [ ] CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ GraphQL
- [ ] Markdown –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- [ ] –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (–¥–ª—è moderator —Ä–æ–ª–∏)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö

**Estimated Effort:** 13 story points

---

### 13. üí° P3 - Version History –¥–ª—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–π

**User Story:**
> –ö–∞–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤, —á—Ç–æ–±—ã –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏.

**Acceptance Criteria:**
- [ ] –ú–æ–¥–µ–ª—å `ConceptVersion` —Å snapshot –¥–∞–Ω–Ω—ã—Ö
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä diff –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
- [ ] –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
- [ ] –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –±–æ–ª–µ–µ 50 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π

**Estimated Effort:** 13 story points

---

### 14. üí° P3 - Tags/Labels —Å–∏—Å—Ç–µ–º–∞

**User Story:**
> –ö–∞–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä, —è —Ö–æ—á—É –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–µ–≥–∏ –∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞.

**Acceptance Criteria:**
- [ ] –ú–æ–¥–µ–ª—å `Tag` —Å many-to-many —Å–≤—è–∑—å—é —Å Concept
- [ ] CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–µ–≥–æ–≤
- [ ] –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–µ–≥–∞
- [ ] –ü–æ–∏—Å–∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –ø–æ —Ç–µ–≥–∞–º
- [ ] –¶–≤–µ—Ç–æ–≤–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ —Ç–µ–≥–æ–≤

**Estimated Effort:** 5 story points

---

### 15. üí° P3 - Analytics Dashboard

**User Story:**
> –ö–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã (–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —è–∑—ã–∫–∏).

**Acceptance Criteria:**
- [ ] Dashboard —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏:
  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–Ω—è–º
  - –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (DAU, MAU)
  - –¢–æ–ø-10 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —è–∑—ã–∫–æ–≤
  - API requests statistics
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ —Å Chart.js –∏–ª–∏ Recharts
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤ –≤ PDF

**Estimated Effort:** 13 story points

---

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã —Å –±—ç–∫–ª–æ–≥–æ–º

### –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–∏–Ω—Ç–∞

1. **Grooming** - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∑–∞–¥–∞—á:
   - –£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
   - –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (story points)
   - –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è

2. **Sprint Planning** - –≤—ã–±–æ—Ä –∑–∞–¥–∞—á –Ω–∞ —Å–ø—Ä–∏–Ω—Ç:
   - Capacity: ~20 story points –Ω–∞ —Å–ø—Ä–∏–Ω—Ç
   - –í—ã–±–æ—Ä –∏–∑ —Ç–æ–ø-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–∞–¥–∞—á
   - –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏

3. **Daily** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

4. **Review & Retro** - –¥–µ–º–æ –∏ —Ä–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (Definition of Done)

- [ ] –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –∏ –ø—Ä–æ—à–µ–ª code review
- [ ] Unit —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Integration —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (CLAUDE.md, README.md)
- [ ] GraphQL schema —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ staging –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- [ ] No regressions –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ

---

## –ú–µ—Ç—Ä–∏–∫–∏

**Velocity:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ story points –∑–∞ —Å–ø—Ä–∏–Ω—Ç

**Sprint Goal Achievement:** % –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∏–∑ sprint backlog

**Bug Rate:** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–≥–æ–≤ –Ω–∞ –∑–∞–¥–∞—á—É

---

---

## üöÄ –ù–û–í–´–ï –ó–ê–î–ê–ß–ò: Infrastructure & Production Readiness

### 16. üî• P0 - Error Tracking & Monitoring (Sentry Integration)

**User Story:**
> –ö–∞–∫ DevOps –∏–Ω–∂–µ–Ω–µ—Ä, —è —Ö–æ—á—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ –≤ production, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã.

**Acceptance Criteria:**
- [‚úÖ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sentry (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
- [‚úÖ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ—Ö uncaught exceptions
- [‚úÖ] –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—à–∏–±–æ–∫: user_id, request_id, endpoint, environment
- [‚úÖ] Source maps –¥–ª—è stack traces
- [‚úÖ] Email/Slack —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ Sentry UI)
- [‚úÖ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –æ—à–∏–±–æ–∫ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ Sentry)
- [‚úÖ] Performance monitoring (transaction traces)
- [‚úÖ] Release tracking –¥–ª—è —Å–≤—è–∑–∏ —Å –¥–µ–ø–ª–æ—è–º–∏
- [‚úÖ] Breadcrumbs –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [‚úÖ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã)

**Implementation:**
```python
# core/sentry.py
import sentry_sdk
from sentry_sdk.integrations.starlette import StarletteIntegration
from sentry_sdk.integrations.sqlalchemy import SqlalchemyIntegration

def init_sentry():
    sentry_sdk.init(
        dsn=os.getenv("SENTRY_DSN"),
        environment=os.getenv("ENVIRONMENT", "production"),
        traces_sample_rate=1.0,
        integrations=[
            StarletteIntegration(),
            SqlalchemyIntegration(),
        ],
        before_send=filter_sensitive_data,
    )

# –í app.py
from core.sentry import init_sentry
init_sentry()
```

**Dependencies:** `sentry-sdk[starlette,sqlalchemy]`, `psutil`

**Implementation Details:**
- `core/sentry.py` - Sentry initialization with integrations (Starlette, SQLAlchemy, Logging)
- `app.py` - Automatic initialization on startup
- Environment variables: SENTRY_DSN, ENVIRONMENT, SENTRY_ENABLE_TRACING, SENTRY_TRACES_SAMPLE_RATE
- Automatic user context tracking for authenticated requests
- Comprehensive tests in `tests/test_sentry.py`
- Documentation in CLAUDE.md with setup instructions and usage examples
- Production checklist updated with Sentry configuration steps

**Key Features Implemented:**
- `before_send` filter for automatic sensitive data removal
- User context tracking with username and email
- Breadcrumbs for authenticated requests
- Configurable sample rates (1.0 for dev, 0.1 for production)
- Manual error capture: `capture_exception()`, `capture_message()`
- Performance monitoring: `start_transaction()`
- Helper functions: `set_user_context()`, `add_breadcrumb()`, `set_context()`

**Estimated Effort:** 5 story points

**Status:** ‚úÖ **Done** (2025-01-19)

---

### 17. üî• P0 - Prometheus Metrics Collection

**User Story:**
> –ö–∞–∫ SRE, —è —Ö–æ—á—É —Å–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (latency, throughput, errors), —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã.

**Acceptance Criteria:**
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
- [ ] Endpoint `/metrics` –¥–ª—è scraping
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:
  - `http_requests_total` (counter)
  - `http_request_duration_seconds` (histogram)
  - `http_requests_in_progress` (gauge)
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ GraphQL:
  - `graphql_query_duration_seconds`
  - `graphql_query_errors_total`
  - `graphql_query_complexity`
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
  - `db_connections_active`
  - `db_query_duration_seconds`
  - `db_errors_total`
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ Redis:
  - `redis_connections_active`
  - `redis_commands_total`
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:
  - `users_registered_total`
  - `emails_sent_total`
  - `files_uploaded_total`
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã:
  - `process_cpu_usage`
  - `process_memory_bytes`
  - `process_open_fds`
- [ ] Grafana dashboard template

**Implementation:**
```python
# core/metrics.py
from prometheus_client import Counter, Histogram, Gauge, generate_latest

REQUEST_COUNT = Counter('http_requests_total', 'Total requests', ['method', 'endpoint', 'status'])
REQUEST_DURATION = Histogram('http_request_duration_seconds', 'Request duration')
DB_CONNECTIONS = Gauge('db_connections_active', 'Active DB connections')

# middleware/metrics.py
class PrometheusMiddleware:
    async def __call__(self, request, call_next):
        with REQUEST_DURATION.time():
            response = await call_next(request)
        REQUEST_COUNT.labels(request.method, request.url.path, response.status_code).inc()
        return response

# app.py
@app.route("/metrics")
async def metrics(request):
    return Response(generate_latest(), media_type="text/plain")
```

**Dependencies:** `prometheus-client`, `prometheus-fastapi-instrumentator`

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 18. üî• P0 - Background Task Processing (Celery)

**User Story:**
> –ö–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —è —Ö–æ—á—É –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–æ—Ç–ø—Ä–∞–≤–∫–∞ email, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤), —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å API –∑–∞–ø—Ä–æ—Å—ã.

**Acceptance Criteria:**
- [ ] Celery setup —Å Redis/RabbitMQ broker
- [ ] Worker –ø—Ä–æ—Ü–µ—Å—Å –≤ Docker Compose
- [ ] –ó–∞–¥–∞—á–∏:
  - `send_email_task` - –æ—Ç–ø—Ä–∞–≤–∫–∞ email
  - `cleanup_old_logs_task` - –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö audit logs
  - `generate_report_task` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
  - `process_image_task` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  - `send_notification_task` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] Scheduled tasks (Celery Beat):
  - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
  - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  - –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –±—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö
- [ ] Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å exponential backoff
- [ ] Task monitoring —á–µ—Ä–µ–∑ Flower
- [ ] Task result backend (Redis)
- [ ] GraphQL query –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏: `taskStatus(taskId: ID!)`
- [ ] Dead letter queue –¥–ª—è failed tasks
- [ ] Rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–¥–∞—á

**Implementation:**
```python
# core/celery_app.py
from celery import Celery

celery_app = Celery(
    "multipult",
    broker=os.getenv("CELERY_BROKER_URL"),
    backend=os.getenv("CELERY_RESULT_BACKEND"),
)

celery_app.conf.update(
    task_serializer="json",
    result_serializer="json",
    timezone="UTC",
    enable_utc=True,
)

# tasks/email_tasks.py
@celery_app.task(bind=True, max_retries=3)
def send_email_task(self, to: str, subject: str, body: str):
    try:
        send_email(to, subject, body)
    except Exception as exc:
        raise self.retry(exc=exc, countdown=60 * (2 ** self.request.retries))

# tasks/cleanup_tasks.py
@celery_app.task
def cleanup_old_logs():
    AuditService.cleanup_old_logs(days=90)

# Celery Beat schedule
celery_app.conf.beat_schedule = {
    'cleanup-logs-daily': {
        'task': 'tasks.cleanup_tasks.cleanup_old_logs',
        'schedule': crontab(hour=2, minute=0),
    },
}
```

**Dependencies:** `celery[redis]`, `flower`

**Docker Compose:**
```yaml
services:
  celery_worker:
    build: .
    command: celery -A core.celery_app worker --loglevel=info
    depends_on:
      - redis
      - db

  celery_beat:
    build: .
    command: celery -A core.celery_app beat --loglevel=info
    depends_on:
      - redis

  flower:
    build: .
    command: celery -A core.celery_app flower --port=5555
    ports:
      - "5555:5555"
```

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

### 19. üî• P0 - Structured Logging (JSON Format)

**User Story:**
> –ö–∞–∫ DevOps –∏–Ω–∂–µ–Ω–µ—Ä, —è —Ö–æ—á—É –∏–º–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ–±—ã –ª–µ–≥–∫–æ –∏—Ö –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ ELK/CloudWatch.

**Acceptance Criteria:**
- [ ] JSON formatter –¥–ª—è –ª–æ–≥–æ–≤
- [ ] –ü–æ–ª—è –≤ –∫–∞–∂–¥–æ–º –ª–æ–≥–µ:
  - `timestamp` (ISO 8601)
  - `level` (INFO, WARNING, ERROR)
  - `message`
  - `service` (backend)
  - `environment` (dev/staging/prod)
  - `request_id` (correlation ID)
  - `user_id` (–µ—Å–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω)
  - `endpoint` (GraphQL query/mutation)
  - `duration_ms` (–¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤)
  - `error` (stack trace –µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ª–æ–≥–∏ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
- [ ] Log levels –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ env
- [ ] –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ (–ø–æ —Ä–∞–∑–º–µ—Ä—É/–¥–∞—Ç–µ)
- [ ] Separate log streams: access, error, audit
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è sensitive –¥–∞–Ω–Ω—ã—Ö (tokens, passwords)

**Implementation:**
```python
# core/logging_config.py
import logging
import json
from pythonjsonlogger import jsonlogger

class CustomJsonFormatter(jsonlogger.JsonFormatter):
    def add_fields(self, log_record, record, message_dict):
        super().add_fields(log_record, record, message_dict)
        log_record['timestamp'] = datetime.utcnow().isoformat()
        log_record['service'] = 'backend'
        log_record['environment'] = os.getenv('ENVIRONMENT', 'development')
        if hasattr(record, 'request_id'):
            log_record['request_id'] = record.request_id

def setup_logging():
    handler = logging.StreamHandler()
    handler.setFormatter(CustomJsonFormatter())

    logging.basicConfig(
        level=os.getenv('LOG_LEVEL', 'INFO'),
        handlers=[handler]
    )

# middleware/request_id.py
import uuid

class RequestIDMiddleware:
    async def __call__(self, request, call_next):
        request.state.request_id = str(uuid.uuid4())
        response = await call_next(request)
        response.headers['X-Request-ID'] = request.state.request_id
        return response

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
logger.info("User logged in", extra={
    'user_id': user.id,
    'request_id': request.state.request_id,
    'ip_address': request.client.host
})
```

**Dependencies:** `python-json-logger`

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 20. üî• P0 - Request ID & Distributed Tracing

**User Story:**
> –ö–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —è —Ö–æ—á—É –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (API ‚Üí DB ‚Üí Redis ‚Üí Celery), —á—Ç–æ–±—ã –Ω–∞—Ö–æ–¥–∏—Ç—å bottlenecks.

**Acceptance Criteria:**
- [ ] Request ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- [ ] Request ID –≤ headers: `X-Request-ID`
- [ ] Request ID –≤ –ª–æ–≥–∞—Ö –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] Request ID –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ Celery tasks
- [ ] OpenTelemetry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] Jaeger/Zipkin –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ traces (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] Trace spans –¥–ª—è:
  - GraphQL query/mutation
  - Database queries
  - Redis operations
  - External API calls
  - Celery tasks
- [ ] Correlation ID –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É requests

**Implementation:** —Å–º. –∑–∞–¥–∞—á—É 19 (RequestIDMiddleware)

**Dependencies:** `opentelemetry-api`, `opentelemetry-instrumentation-starlette` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 21. ‚ö° P1 - Application-Level Rate Limiting

**User Story:**
> –ö–∞–∫ backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —è —Ö–æ—á—É –∏–º–µ—Ç—å rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–µ —Ç–æ–ª—å–∫–æ nginx), —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç abuse –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ API endpoints.

**Acceptance Criteria:**
- [ ] Decorator –¥–ª—è rate limiting –Ω–∞ –º—É—Ç–∞—Ü–∏—è—Ö/queries
- [ ] Redis-backed —Å—á–µ—Ç—á–∏–∫–∏
- [ ] –õ–∏–º–∏—Ç—ã –ø–æ:
  - IP –∞–¥—Ä–µ—Å—É
  - User ID
  - API key (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoints:
  - `@rate_limit(max_requests=100, window_seconds=60)` - –æ–±—ã—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  - `@rate_limit(max_requests=5, window_seconds=60)` - auth endpoints
  - `@rate_limit(max_requests=10, window_seconds=3600)` - file uploads
- [ ] HTTP headers –≤ –æ—Ç–≤–µ—Ç–µ:
  - `X-RateLimit-Limit`
  - `X-RateLimit-Remaining`
  - `X-RateLimit-Reset`
- [ ] GraphQL error: `RATE_LIMIT_EXCEEDED`
- [ ] Whitelist –¥–ª—è admin users
- [ ] Sliding window algorithm
- [ ] Metrics –¥–ª—è rate limit hits

**Implementation:**
```python
# core/rate_limiter.py
from functools import wraps
from core.redis_client import redis_client

def rate_limit(max_requests: int, window_seconds: int, key_func=None):
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            info = kwargs.get('info')
            request = info.context['request']
            user = info.context.get('user')

            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª—é—á –¥–ª—è rate limit
            if key_func:
                key = key_func(request, user)
            elif user:
                key = f"rate_limit:{func.__name__}:user:{user.id}"
            else:
                key = f"rate_limit:{func.__name__}:ip:{request.client.host}"

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç
            current = await redis_client.incr(key)
            if current == 1:
                await redis_client.expire(key, window_seconds)

            ttl = await redis_client.ttl(key)

            # –î–æ–±–∞–≤–ª—è–µ–º headers –≤ response
            info.context['response'].headers['X-RateLimit-Limit'] = str(max_requests)
            info.context['response'].headers['X-RateLimit-Remaining'] = str(max(0, max_requests - current))
            info.context['response'].headers['X-RateLimit-Reset'] = str(time.time() + ttl)

            if current > max_requests:
                raise GraphQLError(
                    "Rate limit exceeded",
                    extensions={"code": "RATE_LIMIT_EXCEEDED"}
                )

            return await func(*args, **kwargs)
        return wrapper
    return decorator

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
@strawberry.mutation
@rate_limit(max_requests=5, window_seconds=60)
async def login(self, info: Info, input: LoginInput) -> AuthPayload:
    ...
```

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 22. ‚ö° P1 - HTTP Caching Headers Middleware

**User Story:**
> –ö–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —è —Ö–æ—á—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å HTTP caching headers (ETag, Cache-Control), —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –∏ —É—Å–∫–æ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç—ã.

**Acceptance Criteria:**
- [ ] ETag generation –¥–ª—è GET –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] `If-None-Match` header support (304 Not Modified)
- [ ] `Cache-Control` headers:
  - `public, max-age=3600` –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - `private, max-age=300` –¥–ª—è user-specific –¥–∞–Ω–Ω—ã—Ö
  - `no-cache` –¥–ª—è sensitive –¥–∞–Ω–Ω—ã—Ö
- [ ] `Last-Modified` header –¥–ª—è —Ä–µ—Å—É—Ä—Å–æ–≤
- [ ] `Vary` header –¥–ª—è content negotiation
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ decorators
- [ ] Cache invalidation –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] Support –¥–ª—è `If-Modified-Since`

**Implementation:**
```python
# middleware/caching.py
import hashlib

class CachingMiddleware:
    async def __call__(self, request, call_next):
        # –¢–æ–ª—å–∫–æ –¥–ª—è GET –∑–∞–ø—Ä–æ—Å–æ–≤
        if request.method != "GET":
            return await call_next(request)

        response = await call_next(request)

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ETag –∏–∑ body
        body = b""
        async for chunk in response.body_iterator:
            body += chunk

        etag = hashlib.md5(body).hexdigest()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º If-None-Match
        if request.headers.get("If-None-Match") == etag:
            return Response(status_code=304)

        # –î–æ–±–∞–≤–ª—è–µ–º headers
        response.headers["ETag"] = etag
        response.headers["Cache-Control"] = "public, max-age=300"

        return response

# –î–ª—è GraphQL –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cache hints
@strawberry.type
class Language:
    @strawberry.field
    @cache_control(max_age=3600)  # –ö–∞—Å—Ç–æ–º–Ω—ã–π decorator
    def name(self) -> str:
        return self.name
```

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 23. ‚ö° P1 - Input Validation & Sanitization Middleware

**User Story:**
> –ö–∞–∫ security engineer, —è —Ö–æ—á—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏ sanitize –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç injection attacks.

**Acceptance Criteria:**
- [ ] Schema validation –Ω–∞ –≤—Å–µ—Ö inputs
- [ ] HTML/SQL injection protection
- [ ] XSS protection (sanitize HTML tags)
- [ ] Path traversal protection (–¥–ª—è file paths)
- [ ] Email validation
- [ ] URL validation
- [ ] Size limits –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
- [ ] Regex validation –¥–ª—è custom fields
- [ ] Blacklist –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
- [ ] Normalization (trim, lowercase –¥–ª—è emails)

**Implementation:**
```python
# core/validators.py
import bleach
import re

def sanitize_html(text: str) -> str:
    """–£–¥–∞–ª—è–µ—Ç HTML —Ç–µ–≥–∏"""
    return bleach.clean(text, strip=True)

def validate_email(email: str) -> bool:
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    return re.match(pattern, email) is not None

def sanitize_filename(filename: str) -> str:
    """–£–¥–∞–ª—è–µ—Ç –æ–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞"""
    return re.sub(r'[^\w\s.-]', '', filename)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Strawberry input types
@strawberry.input
class CreateConceptInput:
    name: str
    description: str | None = None

    def __post_init__(self):
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ sanitization
        self.name = sanitize_html(self.name.strip())
        if len(self.name) > 255:
            raise ValueError("Name too long")

        if self.description:
            self.description = sanitize_html(self.description.strip())
```

**Dependencies:** `bleach`, `validators`

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 24. ‚ö° P1 - Database Query Optimization & N+1 Prevention

**User Story:**
> –ö–∞–∫ backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —è —Ö–æ—á—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å N+1 queries, —á—Ç–æ–±—ã –Ω–µ –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞–ª–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

**Acceptance Criteria:**
- [ ] SQLAlchemy query logging –≤ development
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `joinedload`/`selectinload`
- [ ] Query analyzer –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è N+1
- [ ] Database indexes –¥–ª—è –≤—Å–µ—Ö foreign keys
- [ ] Composite indexes –¥–ª—è —á–∞—Å—Ç—ã—Ö queries
- [ ] Query result caching (Redis)
- [ ] Database connection pool monitoring
- [ ] Slow query detection (>100ms warning)
- [ ] Query explain plans –≤ –ª–æ–≥–∞—Ö (dev mode)

**Implementation:**
```python
# core/database.py
import logging

# Enable query logging in dev
if os.getenv('DEBUG') == 'True':
    logging.basicConfig()
    logging.getLogger('sqlalchemy.engine').setLevel(logging.INFO)

# Middleware –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ queries
class QueryCounterMiddleware:
    async def __call__(self, request, call_next):
        from sqlalchemy import event

        query_count = 0

        def count_query(conn, cursor, statement, *args):
            nonlocal query_count
            query_count += 1

        event.listen(engine, "before_cursor_execute", count_query)

        response = await call_next(request)

        if query_count > 10:
            logger.warning(f"High query count: {query_count} queries")

        response.headers['X-Query-Count'] = str(query_count)

        event.remove(engine, "before_cursor_execute", count_query)

        return response

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ eager loading
def get_concepts_with_translations(db: Session):
    return db.query(ConceptModel).options(
        joinedload(ConceptModel.dictionaries).joinedload(DictionaryModel.language)
    ).all()
```

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 25. üìå P2 - API Versioning Support

**User Story:**
> –ö–∞–∫ API consumer, —è —Ö–æ—á—É –∏–º–µ—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –ª–æ–º–∞–ª–∏ –º–æ—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.

**Acceptance Criteria:**
- [ ] URL-based versioning: `/graphql/v1`, `/graphql/v2`
- [ ] Header-based versioning: `X-API-Version: 1`
- [ ] Schema stitching –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–µ—Ä—Å–∏–π
- [ ] Deprecation warnings –≤ responses
- [ ] –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º—É—Ç–∞—Ü–∏–π –∏ —Ç–∏–ø–æ–≤
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è changelog –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
- [ ] Sunset headers –¥–ª—è deprecated versions

**Implementation:**
```python
# schemas/v1/schema.py
schema_v1 = strawberry.Schema(query=Query, mutation=Mutation)

# schemas/v2/schema.py
schema_v2 = strawberry.Schema(query=QueryV2, mutation=MutationV2)

# app.py
app.mount("/graphql/v1", GraphQLWithContext(schema_v1))
app.mount("/graphql/v2", GraphQLWithContext(schema_v2))
app.mount("/graphql", GraphQLWithContext(schema_v2))  # Latest
```

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

### 26. üìå P2 - GraphQL Query Complexity Analysis

**User Story:**
> –ö–∞–∫ backend developer, —è —Ö–æ—á—É –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç DoS —á–µ—Ä–µ–∑ complex queries.

**Acceptance Criteria:**
- [ ] Query complexity calculation
- [ ] Max complexity limit (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000)
- [ ] Depth limit (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10 —É—Ä–æ–≤–Ω–µ–π)
- [ ] Cost analysis –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è
- [ ] Rejection —Å–ª–æ–∂–Ω—ã—Ö queries —Å –ø–æ–Ω—è—Ç–Ω—ã–º error message
- [ ] Whitelist –¥–ª—è admin users
- [ ] Metrics –¥–ª—è query complexity

**Implementation:**
```python
# core/query_complexity.py
from strawberry.extensions import Extension

class QueryComplexityExtension(Extension):
    def on_request_start(self):
        complexity = self.calculate_complexity(self.execution_context.query)
        if complexity > 1000:
            raise GraphQLError(f"Query too complex: {complexity}")

schema = strawberry.Schema(
    query=Query,
    extensions=[QueryComplexityExtension]
)
```

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 27. üìå P2 - Automated Database Backup & Restore

**User Story:**
> –ö–∞–∫ DevOps engineer, —è —Ö–æ—á—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö.

**Acceptance Criteria:**
- [ ] Scheduled daily backups (—á–µ—Ä–µ–∑ Celery Beat)
- [ ] Incremental backups –∫–∞–∂–¥—ã–π —á–∞—Å
- [ ] Full backup –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
- [ ] Backup retention policy (30 –¥–Ω–µ–π)
- [ ] Backup –≤ S3/GCS/Azure Blob
- [ ] Backup encryption
- [ ] Restore —Å–∫—Ä–∏–ø—Ç —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [ ] Backup verification (test restore)
- [ ] Metrics –¥–ª—è backup size –∏ duration
- [ ] Alerts –ø—Ä–∏ failed backups

**Implementation:**
```python
# tasks/backup_tasks.py
@celery_app.task
def backup_database():
    timestamp = datetime.utcnow().strftime('%Y%m%d_%H%M%S')
    filename = f"backup_{timestamp}.sql.gz"

    # pg_dump
    os.system(f"pg_dump {DATABASE_URL} | gzip > /tmp/{filename}")

    # Upload to S3
    s3_client.upload_file(f"/tmp/{filename}", "backups", filename)

    # Cleanup old backups
    cleanup_old_backups(days=30)

# Celery Beat schedule
celery_app.conf.beat_schedule['backup-daily'] = {
    'task': 'tasks.backup_tasks.backup_database',
    'schedule': crontab(hour=3, minute=0),
}
```

**Dependencies:** `boto3` (–¥–ª—è S3)

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 28. üìå P2 - Secrets Management (Vault Integration)

**User Story:**
> –ö–∞–∫ security engineer, —è —Ö–æ—á—É —Ö—Ä–∞–Ω–∏—Ç—å secrets –≤ Vault/AWS Secrets Manager, –∞ –Ω–µ –≤ .env —Ñ–∞–π–ª–∞—Ö.

**Acceptance Criteria:**
- [ ] HashiCorp Vault integration
- [ ] AWS Secrets Manager support (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
- [ ] Secrets rotation –±–µ–∑ restart
- [ ] Environment-specific secrets
- [ ] Audit log –¥–ª—è secret access
- [ ] Emergency secrets rotation
- [ ] Secrets –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Fallback –Ω–∞ environment variables

**Implementation:**
```python
# core/secrets.py
import hvac

class SecretsManager:
    def __init__(self):
        self.vault_client = hvac.Client(
            url=os.getenv('VAULT_URL'),
            token=os.getenv('VAULT_TOKEN')
        )

    def get_secret(self, key: str) -> str:
        try:
            response = self.vault_client.secrets.kv.read_secret_version(path=key)
            return response['data']['data']['value']
        except Exception:
            # Fallback –Ω–∞ env
            return os.getenv(key)

secrets = SecretsManager()
JWT_SECRET_KEY = secrets.get_secret('jwt_secret_key')
```

**Dependencies:** `hvac` (Vault client)

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 29. üí° P3 - Multi-Tenancy Support

**User Story:**
> –ö–∞–∫ SaaS provider, —è —Ö–æ—á—É –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å multi-tenancy (–Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ –æ–¥–Ω–æ–π –ë–î), —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å infrastructure costs.

**Acceptance Criteria:**
- [ ] –ú–æ–¥–µ–ª—å `Organization`/`Tenant`
- [ ] Row-level security –¥–ª—è tenant isolation
- [ ] Tenant context –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- [ ] Tenant-specific subdomain routing
- [ ] Tenant-specific settings/branding
- [ ] Tenant usage metrics
- [ ] Tenant data export
- [ ] Cross-tenant admin queries (–¥–ª—è super admin)

**Implementation:**
```python
# auth/models/organization.py
class Organization(BaseModel):
    __tablename__ = "organizations"
    name = Column(String(255), unique=True)
    subdomain = Column(String(100), unique=True)
    settings = Column(JSON)

# User —Å tenant
class User(BaseModel):
    organization_id = Column(Integer, ForeignKey("organizations.id"))
    organization = relationship("Organization")

# Middleware –¥–ª—è tenant context
class TenantMiddleware:
    async def __call__(self, request, call_next):
        subdomain = request.url.hostname.split('.')[0]
        org = db.query(Organization).filter_by(subdomain=subdomain).first()
        request.state.tenant = org
        return await call_next(request)

# Query filter
def get_users_for_tenant(db, tenant_id):
    return db.query(User).filter_by(organization_id=tenant_id).all()
```

**Estimated Effort:** 21 story points

**Status:** üìã Backlog

---

### 30. üí° P3 - Feature Flags System

**User Story:**
> –ö–∞–∫ product manager, —è —Ö–æ—á—É –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å —Ñ–∏—á–∏ –±–µ–∑ –¥–µ–ø–ª–æ—è, —á—Ç–æ–±—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.

**Acceptance Criteria:**
- [ ] Feature flags —Ç–∞–±–ª–∏—Ü–∞ –≤ –ë–î
- [ ] Feature flags admin UI
- [ ] Feature flags –ø–æ:
  - Environment (dev/staging/prod)
  - User ID
  - User role
  - Percentage rollout (canary)
- [ ] Decorator `@feature_flag("new_feature")`
- [ ] GraphQL query: `isFeatureEnabled(name: String!)`
- [ ] Real-time feature flag updates (–±–µ–∑ restart)
- [ ] A/B testing support
- [ ] Feature flag analytics

**Implementation:**
```python
# core/models/feature_flag.py
class FeatureFlag(BaseModel):
    __tablename__ = "feature_flags"
    name = Column(String(100), unique=True)
    enabled = Column(Boolean, default=False)
    rollout_percentage = Column(Integer, default=0)  # 0-100
    enabled_for_roles = Column(ARRAY(String))
    enabled_for_users = Column(ARRAY(Integer))

# core/feature_flags.py
def is_feature_enabled(name: str, user=None) -> bool:
    flag = db.query(FeatureFlag).filter_by(name=name).first()
    if not flag:
        return False

    if flag.enabled:
        return True

    if user and user.id in flag.enabled_for_users:
        return True

    if user and user.role in flag.enabled_for_roles:
        return True

    # Percentage rollout
    if flag.rollout_percentage > 0:
        user_hash = hash(user.id) if user else 0
        return (user_hash % 100) < flag.rollout_percentage

    return False

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
@strawberry.mutation
def create_concept(self, info: Info, input: CreateConceptInput):
    if is_feature_enabled("new_concept_validation", info.context.get('user')):
        # New validation logic
        pass
    else:
        # Old logic
        pass
```

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

### 31. üí° P3 - WebSocket Support –¥–ª—è Real-time Updates

**User Story:**
> –ö–∞–∫ frontend developer, —è —Ö–æ—á—É –ø–æ–ª—É—á–∞—Ç—å real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket, —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∞—Ç—å polling.

**Acceptance Criteria:**
- [ ] WebSocket endpoint `/ws`
- [ ] Authentication —á–µ—Ä–µ–∑ WebSocket (JWT –≤ connection params)
- [ ] Subscribe/Unsubscribe mechanism
- [ ] Channels:
  - `user.{user_id}` - –ª–∏—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - `concept.{concept_id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
  - `system` - —Å–∏—Å—Ç–µ–º–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- [ ] Redis Pub/Sub –¥–ª—è multi-server support
- [ ] Heartbeat/ping-pong –¥–ª—è connection health
- [ ] Reconnection logic –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- [ ] Rate limiting –¥–ª—è WS messages

**Implementation:**
```python
# core/websocket.py
from starlette.websockets import WebSocket, WebSocketDisconnect

class ConnectionManager:
    def __init__(self):
        self.active_connections: dict[str, list[WebSocket]] = {}

    async def connect(self, websocket: WebSocket, channel: str):
        await websocket.accept()
        if channel not in self.active_connections:
            self.active_connections[channel] = []
        self.active_connections[channel].append(websocket)

    async def send_to_channel(self, channel: str, message: dict):
        if channel in self.active_connections:
            for connection in self.active_connections[channel]:
                await connection.send_json(message)

manager = ConnectionManager()

# app.py
@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    await manager.connect(websocket, "system")
    try:
        while True:
            data = await websocket.receive_json()
            # Handle subscribe/unsubscribe
    except WebSocketDisconnect:
        manager.disconnect(websocket)
```

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

### 32. ‚ö° P1 - Enhanced Health Checks

**User Story:**
> –ö–∞–∫ DevOps engineer, —è —Ö–æ—á—É –¥–µ—Ç–∞–ª—å–Ω—ã–µ health checks –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

**Acceptance Criteria:**
- [ ] `/health` - overall health (200/503)
- [ ] `/health/detailed` - —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∏:
  - Database connectivity + query test
  - Redis connectivity + ping
  - Disk space available (>10% free)
  - Memory usage (<90%)
  - Celery workers alive
  - External API dependencies (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] Response format:
```json
{
  "status": "healthy",
  "version": "0.3.0",
  "uptime_seconds": 12345,
  "checks": {
    "database": {"status": "healthy", "latency_ms": 5},
    "redis": {"status": "healthy", "latency_ms": 2},
    "disk": {"status": "healthy", "free_percent": 45},
    "memory": {"status": "warning", "used_percent": 85},
    "celery": {"status": "healthy", "workers": 2}
  }
}
```
- [ ] `/health/liveness` - –¥–ª—è Kubernetes liveness probe
- [ ] `/health/readiness` - –¥–ª—è Kubernetes readiness probe

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 33. üìå P2 - API Documentation Generator (OpenAPI/Swagger)

**User Story:**
> –ö–∞–∫ API consumer, —è —Ö–æ—á—É –∏–º–µ—Ç—å OpenAPI spec –¥–ª—è REST endpoints, —á—Ç–æ–±—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**Acceptance Criteria:**
- [ ] Auto-generated OpenAPI spec –¥–ª—è REST endpoints
- [ ] `/openapi.json` endpoint
- [ ] Swagger UI –Ω–∞ `/docs`
- [ ] ReDoc –Ω–∞ `/redoc`
- [ ] GraphQL schema —ç–∫—Å–ø–æ—Ä—Ç –Ω–∞ `/graphql/schema`
- [ ] Postman collection generator
- [ ] Examples –¥–ª—è –≤—Å–µ—Ö endpoints
- [ ] Authentication section –≤ docs

**Implementation:**
```python
from fastapi import FastAPI
from fastapi.openapi.utils import get_openapi

# –ï—Å–ª–∏ –¥–æ–±–∞–≤–∏–º REST endpoints
rest_app = FastAPI()

@rest_app.get("/api/v1/users/{user_id}")
def get_user(user_id: int):
    """Get user by ID"""
    ...

# Mount REST app alongside GraphQL
app.mount("/api", rest_app)
```

**Dependencies:** `fastapi` (–µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–º REST)

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 34. ‚ö° P1 - Data Migration Tools

**User Story:**
> –ö–∞–∫ developer, —è —Ö–æ—á—É –∏–º–µ—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö.

**Acceptance Criteria:**
- [ ] Data migration framework (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç schema migrations)
- [ ] Reversible migrations (up/down)
- [ ] Migration validation –ø–µ—Ä–µ–¥ apply
- [ ] Dry-run mode
- [ ] Progress reporting –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] Rollback mechanism
- [ ] Migration locking (prevent concurrent runs)
- [ ] Migration audit log

**Implementation:**
```python
# migrations/data/001_migrate_user_roles.py
class MigrateUserRoles:
    def up(self, db: Session):
        # Migrate data forward
        users = db.query(User).filter_by(old_role="moderator").all()
        for user in users:
            user.role_id = new_moderator_role.id
        db.commit()

    def down(self, db: Session):
        # Rollback migration
        users = db.query(User).filter_by(role_id=new_moderator_role.id).all()
        for user in users:
            user.old_role = "moderator"
        db.commit()

# scripts/run_data_migration.py
python run_data_migration.py --migration 001 --dry-run
python run_data_migration.py --migration 001 --apply
```

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 35. üìå P2 - API Client SDK Generator

**User Story:**
> –ö–∞–∫ frontend developer, —è —Ö–æ—á—É –∏–º–µ—Ç—å auto-generated –∫–ª–∏–µ–Ω—Ç –¥–ª—è GraphQL, —á—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å queries –≤—Ä—É—á–Ω—É—é.

**Acceptance Criteria:**
- [ ] GraphQL Code Generator setup
- [ ] TypeScript types –¥–ª—è –≤—Å–µ—Ö GraphQL —Ç–∏–ø–æ–≤
- [ ] React hooks –¥–ª—è queries/mutations (–µ—Å–ª–∏ React frontend)
- [ ] Python client SDK –¥–ª—è backend-to-backend
- [ ] Auto-regeneration –ø—Ä–∏ schema changes
- [ ] Published SDK package (npm/pypi)
- [ ] SDK documentation

**Implementation:**
```yaml
# codegen.yml
schema: http://localhost:8000/graphql
documents: 'src/**/*.graphql'
generates:
  src/generated/graphql.ts:
    plugins:
      - typescript
      - typescript-operations
      - typescript-react-apollo
```

**Dependencies:** `@graphql-codegen/cli`

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 36. üí° P3 - Load Testing Framework

**User Story:**
> –ö–∞–∫ QA engineer, —è —Ö–æ—á—É –∏–º–µ—Ç—å –≥–æ—Ç–æ–≤—ã–µ load tests, —á—Ç–æ–±—ã –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ production.

**Acceptance Criteria:**
- [ ] Locust/K6 setup
- [ ] Test scenarios:
  - Login flow (100 users/sec)
  - Read-heavy queries (500 req/sec)
  - Write-heavy mutations (50 req/sec)
  - File upload (10 concurrent)
- [ ] CI integration –¥–ª—è performance regression tests
- [ ] Performance benchmarks baseline
- [ ] Reports —Å latency percentiles (p50, p95, p99)

**Implementation:**
```python
# tests/load/locustfile.py
from locust import HttpUser, task, between

class GraphQLUser(HttpUser):
    wait_time = between(1, 3)

    def on_start(self):
        # Login
        response = self.client.post("/graphql", json={
            "query": "mutation { login(input: {username: \"test\", password: \"test\"}) { accessToken } }"
        })
        self.token = response.json()['data']['login']['accessToken']

    @task(3)
    def get_languages(self):
        self.client.post("/graphql",
            json={"query": "query { languages { id name } }"},
            headers={"Authorization": f"Bearer {self.token}"}
        )

    @task(1)
    def create_concept(self):
        self.client.post("/graphql",
            json={"query": "mutation { createConcept(...) { id } }"},
            headers={"Authorization": f"Bearer {self.token}"}
        )
```

**Dependencies:** `locust`

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 37. üìå P2 - Environment Configuration Validator

**User Story:**
> –ö–∞–∫ DevOps engineer, —è —Ö–æ—á—É –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –ø–æ–ª—É—á–∏—Ç—å runtime errors –∏–∑-–∑–∞ missing env vars.

**Acceptance Criteria:**
- [ ] Pydantic models –¥–ª—è env configuration
- [ ] Required/optional fields
- [ ] Type validation (int, bool, URL)
- [ ] Default values
- [ ] Environment-specific configs (dev/staging/prod)
- [ ] Startup validation failure –µ—Å–ª–∏ config invalid
- [ ] Config documentation auto-generation

**Implementation:**
```python
# core/config.py
from pydantic import BaseSettings, validator

class Settings(BaseSettings):
    # Database
    DB_HOST: str
    DB_PORT: int = 5432
    DB_NAME: str
    DB_USER: str
    DB_PASSWORD: str

    # JWT
    JWT_SECRET_KEY: str
    JWT_ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30

    # Redis
    REDIS_HOST: str = "redis"
    REDIS_PORT: int = 6379

    # Email
    SMTP_HOST: str
    SMTP_PORT: int
    FROM_EMAIL: str

    @validator('JWT_SECRET_KEY')
    def validate_jwt_secret(cls, v):
        if v == "your-super-secret-jwt-key-change-in-production":
            raise ValueError("You must change JWT_SECRET_KEY in production!")
        if len(v) < 32:
            raise ValueError("JWT_SECRET_KEY must be at least 32 characters")
        return v

    class Config:
        env_file = ".env"

settings = Settings()  # Raises ValidationError if invalid
```

**Dependencies:** `pydantic[dotenv]`

**Estimated Effort:** 3 story points

**Status:** üìã Backlog

---

### 38. ‚ö° P1 - GraphQL Persistent Queries

**User Story:**
> –ö–∞–∫ frontend developer, —è —Ö–æ—á—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å persisted queries, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Ä–∞–∑–º–µ—Ä GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —É–≤–µ–ª–∏—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

**Acceptance Criteria:**
- [ ] Query registration endpoint
- [ ] Query ID <-> Query mapping –≤ Redis
- [ ] Client sends —Ç–æ–ª—å–∫–æ query ID –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ query
- [ ] Automatic Persisted Queries (APQ) support
- [ ] Query whitelist —Ä–µ–∂–∏–º (allow only registered queries)
- [ ] Query registry UI –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

**Implementation:**
```python
# core/persisted_queries.py
class PersistedQueryExtension(Extension):
    async def resolve(self, _next, root, info, *args, **kwargs):
        query_id = info.context['request'].headers.get('X-Query-ID')
        if query_id:
            query = await redis_client.get(f"persisted_query:{query_id}")
            if query:
                info.context['query'] = query
        return await _next(root, info, *args, **kwargs)
```

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 39. üí° P3 - Audit Log Visualization Dashboard

**User Story:**
> –ö–∞–∫ admin, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é audit logs (timeline, charts), —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.

**Acceptance Criteria:**
- [ ] Web UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
- [ ] Filters: user, action, date range, entity type
- [ ] Timeline view
- [ ] Charts: actions per day, top users, error rate
- [ ] Export –≤ CSV/JSON
- [ ] Search –ø–æ description
- [ ] Drill-down –≤ –¥–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

### 40. üìå P2 - GDPR Compliance Tools

**User Story:**
> –ö–∞–∫ compliance officer, —è —Ö–æ—á—É –∏–º–µ—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è GDPR compliance (data export, right to be forgotten), —á—Ç–æ–±—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É.

**Acceptance Criteria:**
- [ ] User data export (JSON/CSV)
  - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–¥–Ω–æ–º –∞—Ä—Ö–∏–≤–µ
  - Profile, audit logs, uploaded files, etc.
- [ ] Right to be forgotten:
  - Hard delete –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - Anonymization –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
- [ ] Consent management:
  - Cookie consent tracking
  - Email consent tracking
  - Data processing consent
- [ ] Data retention policies
- [ ] Data breach notification workflow
- [ ] Privacy policy version tracking

**GraphQL Mutations:**
```graphql
mutation ExportMyData {
  exportMyData {
    downloadUrl
    expiresAt
  }
}

mutation DeleteMyAccount {
  deleteMyAccount(input: {
    password: "current_password"
    reason: "No longer using"
    anonymize: false  # true –¥–ª—è anonymization
  }) {
    success
  }
}
```

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

### 41. üí° P3 - Internationalization (i18n) Framework

**User Story:**
> –ö–∞–∫ backend developer, —è —Ö–æ—á—É –∏–º–µ—Ç—å i18n framework –¥–ª—è error messages –∏ emails, —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —è–∑—ã–∫–æ–≤.

**Acceptance Criteria:**
- [ ] Translation files (JSON/YAML)
- [ ] Language detection –∏–∑:
  - `Accept-Language` header
  - User profile preference
  - Query parameter `?lang=ru`
- [ ] Translated error messages
- [ ] Translated email templates
- [ ] GraphQL queries –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–µ—Ä–µ–≤–æ–¥—ã:
  ```graphql
  query GetConcept($id: ID!, $lang: String = "en") {
    concept(id: $id) {
      name(lang: $lang)
      description(lang: $lang)
    }
  }
  ```
- [ ] Fallback –Ω–∞ default language
- [ ] Translation keys validation (no missing keys)

**Implementation:**
```python
# core/i18n.py
translations = {
    "en": {
        "error.auth.invalid_credentials": "Invalid username or password",
        "error.auth.token_expired": "Token has expired",
    },
    "ru": {
        "error.auth.invalid_credentials": "–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å",
        "error.auth.token_expired": "–¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫",
    }
}

def translate(key: str, lang: str = "en") -> str:
    return translations.get(lang, {}).get(key, translations["en"][key])
```

**Dependencies:** `python-i18n`, `babel`

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 42. ‚ö° P1 - Database Read Replicas Support

**User Story:**
> –ö–∞–∫ backend architect, —è —Ö–æ—á—É –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å read replicas –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è read-heavy workloads.

**Acceptance Criteria:**
- [ ] Multiple database connections (primary + replicas)
- [ ] Read queries –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–¥—É—Ç –Ω–∞ replicas
- [ ] Write queries –∏–¥—É—Ç –Ω–∞ primary
- [ ] Fallback –Ω–∞ primary –µ—Å–ª–∏ replica unavailable
- [ ] Replica lag monitoring
- [ ] Session-level routing (sticky sessions)

**Implementation:**
```python
# core/database.py
from sqlalchemy.orm import sessionmaker

# Primary DB (writes)
primary_engine = create_engine(PRIMARY_DATABASE_URL)
PrimarySession = sessionmaker(bind=primary_engine)

# Read replica (reads)
replica_engine = create_engine(REPLICA_DATABASE_URL)
ReplicaSession = sessionmaker(bind=replica_engine)

# Routing
class DatabaseRouter:
    def get_session(self, write: bool = False):
        if write:
            return PrimarySession()
        else:
            return ReplicaSession()

db_router = DatabaseRouter()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
def get_languages():
    db = db_router.get_session(write=False)  # Read from replica
    return db.query(Language).all()

def create_language(name: str):
    db = db_router.get_session(write=True)  # Write to primary
    ...
```

**Estimated Effort:** 13 story points

**Status:** üìã Backlog

---

### 43. üìå P2 - API Gateway Integration (Kong/Envoy)

**User Story:**
> –ö–∞–∫ platform engineer, —è —Ö–æ—á—É –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å API Gateway –¥–ª—è centralized rate limiting, auth, –∏ monitoring.

**Acceptance Criteria:**
- [ ] Kong/Envoy configuration
- [ ] JWT validation –Ω–∞ gateway level
- [ ] Rate limiting –Ω–∞ gateway
- [ ] Request/response transformation
- [ ] Service mesh integration
- [ ] Canary deployments support
- [ ] Circuit breaker pattern

**Estimated Effort:** 21 story points

**Status:** üìã Backlog

---

### 44. üí° P3 - Event Sourcing & CQRS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**User Story:**
> –ö–∞–∫ architect, —è —Ö–æ—á—É –∏–º–µ—Ç—å event sourcing –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö entities, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π.

**Acceptance Criteria:**
- [ ] Event store (PostgreSQL –∏–ª–∏ EventStoreDB)
- [ ] Event models:
  - `UserCreatedEvent`
  - `UserUpdatedEvent`
  - `ConceptCreatedEvent`
  - etc.
- [ ] Event replay mechanism
- [ ] Read models (projections)
- [ ] Command handlers
- [ ] Event handlers
- [ ] Snapshots –¥–ª—è performance

**Estimated Effort:** 34 story points

**Status:** üìã Backlog

---

### 45. üìå P2 - Service Health Dashboard

**User Story:**
> –ö–∞–∫ operations engineer, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å dashboard —Å–æ –≤—Å–µ–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ health checks –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

**Acceptance Criteria:**
- [ ] Grafana dashboard setup
- [ ] Panels:
  - Request rate (req/sec)
  - Error rate (%)
  - Latency percentiles (p50, p95, p99)
  - Database connections
  - Redis memory usage
  - Celery queue length
  - Disk space
  - Memory usage
- [ ] Alerts configuration
- [ ] Historical data (30 days)

**Dependencies:** Prometheus + Grafana

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 46. ‚ö° P1 - Security Headers Middleware (App-Level)

**User Story:**
> –ö–∞–∫ security engineer, —è —Ö–æ—á—É –∏–º–µ—Ç—å security headers –Ω–∞ app level (–Ω–µ —Ç–æ–ª—å–∫–æ nginx), —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å API –¥–∞–∂–µ –µ—Å–ª–∏ nginx bypassed.

**Acceptance Criteria:**
- [ ] Headers –≤ –∫–∞–∂–¥–æ–º response:
  - `X-Content-Type-Options: nosniff`
  - `X-Frame-Options: DENY`
  - `X-XSS-Protection: 1; mode=block`
  - `Strict-Transport-Security: max-age=31536000`
  - `Content-Security-Policy`
  - `Referrer-Policy: no-referrer`
  - `Permissions-Policy`
- [ ] Configurable —á–µ—Ä–µ–∑ env vars
- [ ] Middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

**Implementation:**
```python
# middleware/security_headers.py
class SecurityHeadersMiddleware:
    async def __call__(self, request, call_next):
        response = await call_next(request)
        response.headers['X-Content-Type-Options'] = 'nosniff'
        response.headers['X-Frame-Options'] = 'DENY'
        response.headers['X-XSS-Protection'] = '1; mode=block'
        response.headers['Strict-Transport-Security'] = 'max-age=31536000; includeSubDomains'
        response.headers['Content-Security-Policy'] = "default-src 'self'"
        return response
```

**Estimated Effort:** 2 story points

**Status:** üìã Backlog

---

### 47. üìå P2 - Database Connection Pool Monitoring

**User Story:**
> –ö–∞–∫ DBA, —è —Ö–æ—á—É –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å connection pool (active connections, wait time), —á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å pool settings.

**Acceptance Criteria:**
- [ ] Metrics:
  - Active connections
  - Idle connections
  - Waiting requests
  - Connection acquisition time
  - Connection errors
- [ ] Prometheus metrics export
- [ ] Alerts –ø—Ä–∏ pool exhaustion
- [ ] Auto-scaling pool size (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Implementation:**
```python
# core/database.py
from prometheus_client import Gauge

db_connections_active = Gauge('db_connections_active', 'Active DB connections')
db_connections_idle = Gauge('db_connections_idle', 'Idle DB connections')

def update_db_metrics():
    pool = engine.pool
    db_connections_active.set(pool.checkedout())
    db_connections_idle.set(pool.size() - pool.checkedout())

# Periodic task –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
@celery_app.task
def collect_db_metrics():
    update_db_metrics()
```

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 48. üí° P3 - GraphQL Schema Stitching/Federation

**User Story:**
> –ö–∞–∫ microservices architect, —è —Ö–æ—á—É –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ GraphQL —Å—Ö–µ–º –≤ –æ–¥–Ω—É, —á—Ç–æ–±—ã frontend –¥–µ–ª–∞–ª –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–¥–Ω–æ–º—É endpoint.

**Acceptance Criteria:**
- [ ] Apollo Federation setup
- [ ] Service A (auth service)
- [ ] Service B (content service)
- [ ] Gateway –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Å—Ö–µ–º
- [ ] Cross-service references
- [ ] Distributed queries

**Dependencies:** `strawberry-graphql[apollo-federation]`

**Estimated Effort:** 21 story points

**Status:** üìã Backlog

---

### 49. üìå P2 - CLI Tool –¥–ª—è Admin Tasks

**User Story:**
> –ö–∞–∫ admin, —è —Ö–æ—á—É –∏–º–µ—Ç—å CLI tool –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è admin tasks (create user, reset password, run migrations).

**Acceptance Criteria:**
- [ ] Click/Typer based CLI
- [ ] Commands:
  - `python cli.py user create --username admin --role admin`
  - `python cli.py user reset-password --email user@example.com`
  - `python cli.py db migrate`
  - `python cli.py db seed`
  - `python cli.py backup create`
  - `python cli.py logs cleanup --days 90`
- [ ] Interactive prompts –¥–ª—è sensitive operations
- [ ] Progress bars –¥–ª—è long-running tasks
- [ ] Colorized output

**Implementation:**
```python
# cli.py
import click

@click.group()
def cli():
    """Admin CLI for –ú—É–ª—å—Ç–∏–ü–£–õ–¨–¢"""
    pass

@cli.group()
def user():
    """User management commands"""
    pass

@user.command()
@click.option('--username', required=True)
@click.option('--email', required=True)
@click.option('--role', default='user')
def create(username, email, role):
    """Create a new user"""
    click.echo(f"Creating user {username}...")
    # Logic here

if __name__ == '__main__':
    cli()
```

**Dependencies:** `click` or `typer`

**Estimated Effort:** 8 story points

**Status:** üìã Backlog

---

### 50. ‚ö° P1 - Comprehensive Integration Tests

**User Story:**
> –ö–∞–∫ QA engineer, —è —Ö–æ—á—É –∏–º–µ—Ç—å –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ integration tests –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö flows.

**Acceptance Criteria:**
- [ ] Test coverage >80%
- [ ] Integration tests –¥–ª—è:
  - Auth flow (register ‚Üí verify ‚Üí login ‚Üí refresh)
  - OAuth flow (Google, Telegram)
  - File upload ‚Üí thumbnail ‚Üí serve
  - CRUD operations –¥–ª—è –≤—Å–µ—Ö entities
  - Permissions/authorization
  - Rate limiting
  - Email sending
  - Audit logging
- [ ] Test fixtures –¥–ª—è –≤—Å–µ—Ö scenarios
- [ ] Parallel test execution
- [ ] CI integration —Å code coverage report

**Estimated Effort:** 21 story points

**Status:** üìã Backlog

---

### 51. üìå P2 - Docker Multi-Stage Build Optimization

**User Story:**
> –ö–∞–∫ DevOps engineer, —è —Ö–æ—á—É –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Docker image size –∏ build time.

**Acceptance Criteria:**
- [ ] Multi-stage Dockerfile
- [ ] Separate build –∏ runtime stages
- [ ] Layer caching optimization
- [ ] Image size <200MB (—Å–µ–π—á–∞—Å ~500MB)
- [ ] Security scanning (Trivy/Snyk)
- [ ] Non-root user –¥–ª—è runtime
- [ ] .dockerignore optimization

**Implementation:**
```dockerfile
# Dockerfile (multi-stage)
FROM python:3.11-slim as builder
WORKDIR /build
COPY requirements.txt .
RUN pip install --no-cache-dir --user -r requirements.txt

FROM python:3.11-slim
WORKDIR /app
COPY --from=builder /root/.local /root/.local
COPY . .
ENV PATH=/root/.local/bin:$PATH
RUN adduser --disabled-password --gecos '' appuser
USER appuser
CMD ["python", "app.py"]
```

**Estimated Effort:** 3 story points

**Status:** üìã Backlog

---

### 52. üí° P3 - A/B Testing Framework

**User Story:**
> –ö–∞–∫ product manager, —è —Ö–æ—á—É –ø—Ä–æ–≤–æ–¥–∏—Ç—å A/B —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏—á–∏, —á—Ç–æ–±—ã –∏–∑–º–µ—Ä—è—Ç—å impact.

**Acceptance Criteria:**
- [ ] Experiment framework
- [ ] Variant assignment (A/B/C)
- [ ] Consistent assignment (same user ‚Üí same variant)
- [ ] Metrics tracking
- [ ] Statistical significance calculation
- [ ] Admin UI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è experiments
- [ ] GraphQL query: `getExperimentVariant(experimentName: String!)`

**Estimated Effort:** 21 story points

**Status:** üìã Backlog

---

### 53. üìå P2 - API Request/Response Logging

**User Story:**
> –ö–∞–∫ support engineer, —è —Ö–æ—á—É –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ API requests/responses –¥–ª—è debugging customer issues.

**Acceptance Criteria:**
- [ ] Request logging:
  - Method, path, headers, body
  - User ID (if authenticated)
  - Request ID
  - Timestamp
- [ ] Response logging:
  - Status code
  - Response time
  - Body (optional, –¥–ª—è errors)
- [ ] Configurable log level (dev: verbose, prod: errors only)
- [ ] PII filtering (passwords, tokens)
- [ ] Log retention policy
- [ ] Search by request_id

**Implementation:**
```python
# middleware/request_logging.py
import time

class RequestLoggingMiddleware:
    async def __call__(self, request, call_next):
        start_time = time.time()

        # Log request
        logger.info("Request", extra={
            'method': request.method,
            'path': request.url.path,
            'request_id': request.state.request_id,
            'user_id': getattr(request.state, 'user_id', None)
        })

        response = await call_next(request)

        # Log response
        duration = time.time() - start_time
        logger.info("Response", extra={
            'request_id': request.state.request_id,
            'status_code': response.status_code,
            'duration_ms': duration * 1000
        })

        return response
```

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

### 54. ‚ö° P1 - Graceful Shutdown Handling

**User Story:**
> –ö–∞–∫ platform engineer, —è —Ö–æ—á—É graceful shutdown –ø—Ä–∏ –¥–µ–ø–ª–æ–µ, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ requests.

**Acceptance Criteria:**
- [ ] Signal handlers (SIGTERM, SIGINT)
- [ ] Wait for active requests to complete (timeout: 30s)
- [ ] Reject new requests –≤–æ –≤—Ä–µ–º—è shutdown
- [ ] Close database connections gracefully
- [ ] Close Redis connections
- [ ] Flush logs
- [ ] Health check returns 503 during shutdown

**Implementation:**
```python
# app.py
import signal
import asyncio

shutdown_event = asyncio.Event()

def shutdown_handler(signum, frame):
    logger.info("Received shutdown signal")
    shutdown_event.set()

signal.signal(signal.SIGTERM, shutdown_handler)
signal.signal(signal.SIGINT, shutdown_handler)

# Uvicorn —Å graceful shutdown
if __name__ == "__main__":
    uvicorn.run(
        "app:app",
        host="0.0.0.0",
        port=8000,
        timeout_graceful_shutdown=30
    )
```

**Estimated Effort:** 3 story points

**Status:** üìã Backlog

---

### 55. üìå P2 - Template Customization System

**User Story:**
> –ö–∞–∫ template user, —è —Ö–æ—á—É –ª–µ–≥–∫–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å email templates, error messages, –∏ –±—Ä–µ–Ω–¥–∏–Ω–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

**Acceptance Criteria:**
- [ ] Configurable branding:
  - App name
  - Logo URL
  - Primary color
  - Email sender name
- [ ] Custom email templates (Jinja2)
- [ ] Custom error messages
- [ ] Template variables injection
- [ ] Preview mode –¥–ª—è templates
- [ ] Version control –¥–ª—è templates

**Implementation:**
```python
# core/branding.py
class BrandingConfig:
    def __init__(self):
        self.app_name = os.getenv('APP_NAME', '–ú—É–ª—å—Ç–∏–ü–£–õ–¨–¢')
        self.logo_url = os.getenv('LOGO_URL', '/static/logo.png')
        self.primary_color = os.getenv('PRIMARY_COLOR', '#007bff')
        self.email_sender = os.getenv('EMAIL_SENDER', 'noreply@multipult.dev')

branding = BrandingConfig()

# –í email templates
<!DOCTYPE html>
<html>
<head>
    <style>
        .header { background-color: {{ branding.primary_color }}; }
    </style>
</head>
<body>
    <div class="header">
        <img src="{{ branding.logo_url }}" alt="{{ branding.app_name }}">
    </div>
    ...
</body>
</html>
```

**Estimated Effort:** 5 story points

**Status:** üìã Backlog

---

## üìä Summary

**–í—Å–µ–≥–æ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á:** 40 (16-55)

**–ü–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º:**
- üî• P0 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ): 5 –∑–∞–¥–∞—á
- ‚ö° P1 (–í—ã—Å–æ–∫–∏–µ): 12 –∑–∞–¥–∞—á
- üìå P2 (–°—Ä–µ–¥–Ω–∏–µ): 14 –∑–∞–¥–∞—á
- üí° P3 (–ù–∏–∑–∫–∏–µ): 9 –∑–∞–¥–∞—á

**–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:**
- **Infrastructure & Monitoring:** 8 –∑–∞–¥–∞—á
- **Security:** 6 –∑–∞–¥–∞—á
- **Performance:** 6 –∑–∞–¥–∞—á
- **Developer Experience:** 8 –∑–∞–¥–∞—á
- **Production Readiness:** 7 –∑–∞–¥–∞—á
- **Advanced Features:** 5 –∑–∞–¥–∞—á

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-01-19

**–°–ª–µ–¥—É—é—â–∏–π Review:** –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ (Quick Wins):**
1. Error Tracking (Sentry) - #16
2. Prometheus Metrics - #17
3. Structured Logging - #19
4. Request ID Tracking - #20
5. Application Rate Limiting - #21
6. Enhanced Health Checks - #32
7. Environment Config Validator - #37
8. Security Headers Middleware - #46
9. Graceful Shutdown - #54
10. Integration Tests - #50
